- alias: 'Misc: Turn off all'
  initial_state: 'on'
  trigger:
      platform: time
      at: '03:00'
  action:
    - service: script.turn_off_all


- alias: 'Misc: Update Available Notifications'
  initial_state: 'on'
  trigger:
    platform: state
    entity_id: updater.updater
  action:
    - service: notify.ios_iphones_app
      data:
        title: 'Update'
        message: 'Update for Home Assistant is available.'

# Inspired by https://community.home-assistant.io/t/logger-set-level/14267
- alias: 'Misc: Log Level'
  initial_state: 'on'
  trigger:
    platform: state
    entity_id: input_select.log_level
  action:
    service: logger.set_level
    data_template:
      homeassistant.components: "{{ trigger.to_state.state }}"


# automations for the fan
- alias: 'Misc: Activate Fan auto off'
  initial_state: 'on'
  trigger:
    platform: state
    entity_id: switch.ventilator
    to: 'on'
  action: 
    - service: script.turn_off_fan_after_delay

- alias: 'Misc: Deactivate fan auto off'
  initial_state: 'on'
  trigger:
    platform: state
    entity_id: switch.ventilator
    to: 'off'
  action: 
    - service: script.turn_off
      entity_id: script.turn_off_fan_after_delay 

- alias: 'Misc: Turn of speaker if unused at startup'
  initial_state: 'on'
  trigger:
    platform: homeassistant
    event: start
  condition:
    condition: and
    conditions:
      - condition: state
        entity_id: group.personen
        state: 'home'
      - condition: state
        entity_id: media_player.living_room
        state: 'paused'
  action:
    - service: homeassistant.turn_off
      entity_id: group.all_speaker

- alias: 'Misc: Startup default states'
  initial_state: 'on'
  trigger:
    platform: homeassistant
    event: start
  action:
    - service: script.init_hass   

- alias: 'Misc: Startup nobody is home'
  initial_state: 'on'
  trigger:
    platform: homeassistant
    event: start
  condition:
    - condition: state
      entity_id: group.personen
      state: 'not_home'
  action:
    - service: homeassistant.turn_off
      entity_id: group.all_speaker
    - service: input_select.select_option
      data:
        entity_id: input_select.tv_mode
        option: AUS
    - service: switch.turn_off
      entity_id: switch.tv
    - service: script.init_hass

- alias: 'Misc: Update config if travis build is successfull'
  initial_state: 'on'
  trigger:
    platform: state
    entity_id: sensor.tribunexhome_assistant_last_build_state
    to: 'passed'
  action:
    # turn on TV before updating the config, since the broadlink needs to be on during startup
    - service: script.get_latest_config

- alias: 'Misc: Raspberry full volume'
  initial_state: 'on'
  trigger:
    platform: numeric_state
    entity_id: sensor.disk_used_
    above: 90
  action:
    - service: notify.ios_iphones_app
      data:
        title: 'System'
        message: 'Volume is running out of space. Current usage is: {{states.sensor.disk_use_.state}}%'

- alias: 'Tradfri: Low battery'
  initial_state: 'on'
  trigger:
    - platform: numeric_state
      entity_id: sensor.eingang, sensor.bad, sensor.kueche
      below: 10
  action:
    - service: notify.ios_iphones_app   
      data_template:   
        title: 'Devices'    
        message: 'Tradfri battery is low! Battery state of {{ trigger.to_state.attributes.friendly_name }} is {{ trigger.to_state.state }}%'